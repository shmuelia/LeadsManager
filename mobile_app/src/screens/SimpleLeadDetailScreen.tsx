import React, { useState, useEffect } from 'react';\nimport {\n  View,\n  ScrollView,\n  Alert,\n  StyleSheet,\n  Linking,\n  I18nManager,\n} from 'react-native';\nimport {\n  Card,\n  Title,\n  Paragraph,\n  Button,\n  Chip,\n  ActivityIndicator,\n  Divider,\n} from 'react-native-paper';\nimport { StackNavigationProp } from '@react-navigation/stack';\nimport { RouteProp } from '@react-navigation/native';\nimport { RootStackParamList } from '../../App';\nimport { LeadWithActivities } from '../types/Lead';\nimport LeadsService from '../services/LeadsService';\n\n// Enable RTL for Hebrew\nI18nManager.forceRTL(true);\n\ntype LeadDetailScreenNavigationProp = StackNavigationProp<RootStackParamList, 'LeadDetail'>;\ntype LeadDetailScreenRouteProp = RouteProp<RootStackParamList, 'LeadDetail'>;\n\ninterface Props {\n  navigation: LeadDetailScreenNavigationProp;\n  route: LeadDetailScreenRouteProp;\n}\n\nconst SimpleLeadDetailScreen: React.FC<Props> = ({ navigation, route }) => {\n  const { leadId } = route.params;\n  const [leadData, setLeadData] = useState<LeadWithActivities | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  const loadLeadData = async () => {\n    try {\n      const data = await LeadsService.getLead(leadId);\n      setLeadData(data);\n    } catch (error) {\n      Alert.alert('砖', ' 转 注 转 驻专 ');\n      console.error(error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    loadLeadData();\n  }, [leadId]);\n\n  const handleCall = () => {\n    if (leadData?.lead.phone) {\n      const phoneUrl = `tel:${leadData.lead.phone}`;\n      Linking.canOpenURL(phoneUrl).then((supported) => {\n        if (supported) {\n          Linking.openURL(phoneUrl);\n        } else {\n          Alert.alert('砖', ' 转 爪注 砖 砖专 ');\n        }\n      });\n    }\n  };\n\n  const handleWhatsApp = () => {\n    if (leadData?.lead.phone) {\n      const message = `砖 ${leadData.lead.name}, 转拽 驻转 砖专  驻转 . 砖 拽注 转 专`;\n      const whatsappUrl = `whatsapp://send?phone=${leadData.lead.phone}&text=${encodeURIComponent(message)}`;\n      Linking.canOpenURL(whatsappUrl).then((supported) => {\n        if (supported) {\n          Linking.openURL(whatsappUrl);\n        } else {\n          Alert.alert('砖', 'WhatsApp  转拽 砖专');\n        }\n      });\n    }\n  };\n\n  const handleEmail = () => {\n    if (leadData?.lead.email) {\n      const subject = '注 驻转 砖专  驻转 ';\n      const body = `砖 ${leadData.lead.name},\\n\\n转 注 驻转 砖专  驻转 .\\n\\n砖 拽注 转 专.\\n\\n专,\\n爪转 `;\n      const emailUrl = `mailto:${leadData.lead.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;\n      Linking.openURL(emailUrl);\n    }\n  };\n\n  const getHebrewJobInfo = (rawData: any) => {\n    if (!rawData?.raw) return null;\n    \n    const raw = rawData.raw;\n    return {\n      hasExperience: raw['砖__住_转?'] || ' 爪',\n      location: raw['拽_专:'] || ' 爪',\n      description: raw['转转专/_转_砖驻/砖_注_注爪:'] || ' 爪'\n    };\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('he-IL', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'new': return '#2196F3';\n      case 'contacted': return '#FF9800';\n      case 'interested': return '#4CAF50';\n      default: return '#757575';\n    }\n  };\n\n  if (loading) {\n    return (\n      <View style={styles.centered}>\n        <ActivityIndicator size=\"large\" color=\"#2196F3\" />\n        <Paragraph style={styles.loadingText}>注 驻专 ...</Paragraph>\n      </View>\n    );\n  }\n\n  if (!leadData) {\n    return (\n      <View style={styles.centered}>\n        <Paragraph>  爪</Paragraph>\n      </View>\n    );\n  }\n\n  const { lead } = leadData;\n  const jobInfo = getHebrewJobInfo(lead.raw_data);\n\n  return (\n    <ScrollView style={styles.container}>\n      {/* Header Card */}\n      <Card style={styles.card}>\n        <Card.Content>\n          <View style={styles.header}>\n            <Title style={styles.leadName}>{lead.name || ' 砖'}</Title>\n            <Chip \n              style={[styles.statusChip, { backgroundColor: getStatusColor(lead.status) }]}\n              textStyle={styles.statusText}\n            >\n              {lead.status === 'new' ? '砖' : lead.status}\n            </Chip>\n          </View>\n\n          <View style={styles.contactSection}>\n            <Paragraph style={styles.contactItem}> {lead.email}</Paragraph>\n            {lead.phone && <Paragraph style={styles.contactItem}> {lead.phone}</Paragraph>}\n          </View>\n        </Card.Content>\n      </Card>\n\n      {/* Quick Actions */}\n      <Card style={styles.card}>\n        <Card.Content>\n          <Title style={styles.sectionTitle}>驻注转 专转</Title>\n          <View style={styles.actionButtons}>\n            <Button \n              mode=\"contained\" \n              icon=\"phone\"\n              onPress={handleCall}\n              disabled={!lead.phone}\n              style={[styles.actionButton, styles.callButton]}\n            >\n              转拽砖专\n            </Button>\n            <Button \n              mode=\"contained\" \n              icon=\"whatsapp\"\n              onPress={handleWhatsApp}\n              disabled={!lead.phone}\n              style={[styles.actionButton, styles.whatsappButton]}\n            >\n              WhatsApp\n            </Button>\n            <Button \n              mode=\"outlined\" \n              icon=\"email\"\n              onPress={handleEmail}\n              disabled={!lead.email}\n              style={styles.actionButton}\n            >\n              \n            </Button>\n          </View>\n        </Card.Content>\n      </Card>\n\n      {/* Job Application Info */}\n      {jobInfo && (\n        <Card style={styles.card}>\n          <Card.Content>\n            <Title style={styles.sectionTitle}>驻专 注转</Title>\n            \n            <View style={styles.infoRow}>\n              <Paragraph style={styles.infoLabel}>住 转:</Paragraph>\n              <Paragraph style={styles.infoValue}>{jobInfo.hasExperience}</Paragraph>\n            </View>\n\n            <View style={styles.infoRow}>\n              <Paragraph style={styles.infoLabel}>拽 专:</Paragraph>\n              <Paragraph style={styles.infoValue}>{jobInfo.location}</Paragraph>\n            </View>\n\n            <Divider style={styles.divider} />\n            \n            <Paragraph style={styles.infoLabel}>转专 注爪:</Paragraph>\n            <Paragraph style={styles.description}>{jobInfo.description}</Paragraph>\n          </Card.Content>\n        </Card>\n      )}\n\n      {/* Source Info */}\n      <Card style={styles.card}>\n        <Card.Content>\n          <Title style={styles.sectionTitle}>拽专 </Title>\n          <View style={styles.sourceInfo}>\n            <Paragraph> 驻驻专: {lead.platform === 'ig' ? '住专' : lead.platform}</Paragraph>\n            <Paragraph> 转拽: {formatDate(lead.received_at)}</Paragraph>\n            {lead.campaign_name && <Paragraph> 拽驻: {lead.campaign_name}</Paragraph>}\n          </View>\n        </Card.Content>\n      </Card>\n    </ScrollView>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#f8f9fa',\n  },\n  centered: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center',\n    padding: 20,\n  },\n  loadingText: {\n    marginTop: 10,\n    fontSize: 16,\n    textAlign: 'center',\n  },\n  card: {\n    margin: 16,\n    marginBottom: 12,\n    borderRadius: 12,\n    elevation: 3,\n  },\n  header: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n    marginBottom: 16,\n  },\n  leadName: {\n    fontSize: 24,\n    fontWeight: 'bold',\n    flex: 1,\n    textAlign: 'right',\n    color: '#1a1a1a',\n  },\n  statusChip: {\n    marginLeft: 8,\n  },\n  statusText: {\n    color: 'white',\n    fontSize: 12,\n    fontWeight: 'bold',\n  },\n  contactSection: {\n    padding: 8,\n    backgroundColor: '#f5f5f5',\n    borderRadius: 8,\n  },\n  contactItem: {\n    fontSize: 16,\n    marginBottom: 4,\n    textAlign: 'right',\n  },\n  sectionTitle: {\n    fontSize: 18,\n    fontWeight: 'bold',\n    marginBottom: 16,\n    textAlign: 'right',\n    color: '#1a1a1a',\n  },\n  actionButtons: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n  },\n  actionButton: {\n    flex: 1,\n    marginHorizontal: 4,\n  },\n  callButton: {\n    backgroundColor: '#4CAF50',\n  },\n  whatsappButton: {\n    backgroundColor: '#25D366',\n  },\n  infoRow: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n    marginBottom: 8,\n  },\n  infoLabel: {\n    fontSize: 14,\n    fontWeight: 'bold',\n    color: '#666',\n    flex: 1,\n    textAlign: 'right',\n  },\n  infoValue: {\n    fontSize: 16,\n    color: '#1a1a1a',\n    flex: 2,\n    textAlign: 'right',\n  },\n  description: {\n    fontSize: 16,\n    lineHeight: 24,\n    padding: 12,\n    backgroundColor: '#f8f9fa',\n    borderRadius: 8,\n    textAlign: 'right',\n    color: '#1a1a1a',\n  },\n  divider: {\n    marginVertical: 12,\n  },\n  sourceInfo: {\n    textAlign: 'right',\n  },\n});\n\nexport default SimpleLeadDetailScreen;